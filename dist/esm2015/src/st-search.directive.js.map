{"version":3,"file":"st-search.directive.js","sourceRoot":"","sources":["../package/src/st-search.directive.ts"],"names":[],"mappings":";;;;AAAA,OAAO,EAAC,SAAS,EAAE,KAAK,EAAqB,UAAU,EAAC,MAAM,eAAe,CAAC;AAC9E,OAAO,EAAC,UAAU,EAAC,MAAM,uBAAuB,CAAC;AACjD,OAAO,EAAC,MAAM,EAAC,MAAM,kBAAkB,CAAC;AACxC,OAAO,EAAC,YAAY,EAAE,oBAAoB,EAAE,GAAG,EAAC,MAAM,gBAAgB,CAAC;AACvE,OAAO,EAAe,SAAS,EAAC,MAAM,YAAY,CAAC;;;;AAMnD,MAAM;;;;;IAIF,YAAoB,KAAoB,EAAU,GAAe;QAA7C,UAAK,GAAL,KAAK,CAAe;QAAU,QAAG,GAAH,GAAG,CAAY;qBAKhC,GAAG;qBAEJ,GAAG;sBAEiB,KAAK;KARxD;;;;;IAUD,MAAM,CAAC,KAAa;QAChB,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,EAAE;YACjC,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAI,CAAC,MAAM,KAAK,MAAM,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI;SACzD,CAAC,CAAC;KACN;;;;IAED,QAAQ;QACJ,uBAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAClD,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;QAC7C,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,EAAC,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC,CAAC;QACrD,MAAM,EAAC,KAAK,EAAC,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;QACxC,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,KAAK,GAAG,KAAK,IAAI,EAAE,CAAC;QAC3C,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,OAAO,CAAC;aAC/D,IAAI,CACD,GAAG,CAAC,CAAC,MAAqB,EAAE,EAAE,CAAC,mBAAC,MAAM,CAAC,MAA0B,EAAC,CAAC,KAAK,CAAC,EACzE,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,EACxB,oBAAoB,EAAE,CACzB;aACA,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;KACvC;;;;IAED,WAAW;QACP,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,CAAC;KACzC;;;YA5CJ,SAAS,SAAC;gBACP,QAAQ,EAAE,YAAY;gBACtB,QAAQ,EAAE,UAAU;aACvB;;;;YARO,UAAU;YAD2B,UAAU;;;sBAiBlD,KAAK,SAAC,UAAU;sBAEhB,KAAK,SAAC,gBAAgB;sBAEtB,KAAK,SAAC,eAAe;uBAErB,KAAK,SAAC,gBAAgB","sourcesContent":["import {Directive, Input, OnInit, OnDestroy, ElementRef} from '@angular/core';\nimport {SmartTable} from './smart-table.service';\nimport {search} from 'smart-table-core';\nimport {debounceTime, distinctUntilChanged, map} from 'rxjs/operators';\nimport {Subscription, fromEvent} from 'rxjs/index';\n\n@Directive({\n    selector: '[stSearch]',\n    exportAs: 'stSearch'\n})\nexport class StSearchDirective<T> implements OnInit, OnDestroy {\n    private _directive: any;\n    private _inputSubscription: Subscription;\n\n    constructor(private table: SmartTable<T>, private _el: ElementRef) {\n    }\n\n    @Input('stSearch') scope: string | string[];\n\n    @Input('stDebounceTime') delay = 300;\n\n    @Input('stSearchFlags') flags = 'i';\n\n    @Input('stSearchEscape') escape: boolean | string = false;\n\n    search(value: string): void {\n        return this._directive.search(value, {\n            flags: this.flags,\n            escape: this.escape === 'true' || this.escape === true\n        });\n    }\n\n    ngOnInit() {\n        const scope = Array.isArray(this.scope) ? this.scope :\n            this.scope.split(',').map(p => p.trim());\n        this._directive = search({scope, table: this.table});\n        const {value} = this._directive.state();\n        this._el.nativeElement.value = value || '';\n        this._inputSubscription = fromEvent(this._el.nativeElement, 'input')\n            .pipe(\n                map(($event: KeyboardEvent) => ($event.target as HTMLInputElement).value),\n                debounceTime(this.delay),\n                distinctUntilChanged(),\n            )\n            .subscribe(v => this.search(v));\n    }\n\n    ngOnDestroy() {\n        this._directive.off();\n        this._inputSubscription.unsubscribe();\n    }\n}\n"]}