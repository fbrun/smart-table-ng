{"version":3,"file":"st-search.directive.js","sourceRoot":"","sources":["../../src/st-search.directive.ts"],"names":[],"mappings":";;;;AAAA,OAAO,EAAC,SAAS,EAAE,KAAK,EAAqB,UAAU,EAAC,MAAM,eAAe,CAAC;AAC9E,OAAO,EAAC,UAAU,EAAC,MAAM,uBAAuB,CAAC;AACjD,OAAO,EAAC,eAAe,IAAI,MAAM,EAAC,MAAM,kBAAkB,CAAC;AAC3D,OAAO,EAAC,YAAY,EAAE,oBAAoB,EAAE,GAAG,EAAC,MAAM,gBAAgB,CAAC;AACvE,OAAO,EAAe,SAAS,EAAC,MAAM,YAAY,CAAC;;;;;IAU/C,2BAAoB,KAAoB,EAAU,GAAe;QAA7C,UAAK,GAAL,KAAK,CAAe;QAAU,QAAG,GAAH,GAAG,CAAY;qBAKhC,GAAG;qBAEJ,GAAG;sBAEiB,KAAK;KARxD;;;;;IAUD,kCAAM;;;;IAAN,UAAO,KAAa;QAChB,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,EAAE;YACjC,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAI,CAAC,MAAM,KAAK,MAAM,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI;SACzD,CAAC,CAAC;KACN;;;;IAED,oCAAQ;;;IAAR;QAAA,iBAaC;QAZG,qBAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAClD,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,EAAE,EAAR,CAAQ,CAAC,CAAC;QAC7C,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,EAAC,KAAK,OAAA,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC,CAAC;QAC9C,IAAA,qCAAK,CAA4B;QACxC,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,KAAK,GAAG,KAAK,IAAI,EAAE,CAAC;QAC3C,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,OAAO,CAAC;aAC/D,IAAI,CACD,GAAG,CAAC,UAAA,MAAM,IAAI,OAAA,mBAAmB,mBAAgB,MAAM,EAAC,CAAC,MAAM,EAAC,CAAC,KAAK,EAAxD,CAAwD,CAAC,EACvE,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,EACxB,oBAAoB,EAAE,CACzB;aACA,SAAS,CAAC,UAAC,CAAS,IAAK,OAAA,KAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAd,CAAc,CAAC,CAAC;KACjD;;;;IAED,uCAAW;;;IAAX;QACI,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,CAAC;KACzC;;gBA5CJ,SAAS,SAAC;oBACP,QAAQ,EAAE,YAAY;oBACtB,QAAQ,EAAE,UAAU;iBACvB;;;;gBARO,UAAU;gBAD2B,UAAU;;;0BAiBlD,KAAK,SAAC,UAAU;0BAEhB,KAAK,SAAC,gBAAgB;0BAEtB,KAAK,SAAC,eAAe;2BAErB,KAAK,SAAC,gBAAgB;;4BAvB3B;;SAUa,iBAAiB","sourcesContent":["import {Directive, Input, OnInit, OnDestroy, ElementRef} from '@angular/core';\nimport {SmartTable} from './smart-table.service';\nimport {searchDirective as search} from 'smart-table-core';\nimport {debounceTime, distinctUntilChanged, map} from 'rxjs/operators';\nimport {Subscription, fromEvent} from 'rxjs/index';\n\n@Directive({\n    selector: '[stSearch]',\n    exportAs: 'stSearch'\n})\nexport class StSearchDirective<T> implements OnInit, OnDestroy {\n    private _directive: any;\n    private _inputSubscription: Subscription;\n\n    constructor(private table: SmartTable<T>, private _el: ElementRef) {\n    }\n\n    @Input('stSearch') scope: string | string[];\n\n    @Input('stDebounceTime') delay = 300;\n\n    @Input('stSearchFlags') flags = 'i';\n\n    @Input('stSearchEscape') escape: boolean | string = false;\n\n    search(value: string): void {\n        return this._directive.search(value, {\n            flags: this.flags,\n            escape: this.escape === 'true' || this.escape === true\n        });\n    }\n\n    ngOnInit() {\n        const scope = Array.isArray(this.scope) ? this.scope :\n            this.scope.split(',').map(p => p.trim());\n        this._directive = search({scope, table: this.table});\n        const {value} = this._directive.state();\n        this._el.nativeElement.value = value || '';\n        this._inputSubscription = fromEvent(this._el.nativeElement, 'input')\n            .pipe(\n                map($event => (<HTMLInputElement>(<KeyboardEvent>$event).target).value),\n                debounceTime(this.delay),\n                distinctUntilChanged(),\n            )\n            .subscribe((v: string) => this.search(v));\n    }\n\n    ngOnDestroy() {\n        this._directive.off();\n        this._inputSubscription.unsubscribe();\n    }\n}\n"]}