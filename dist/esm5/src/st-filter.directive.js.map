{"version":3,"file":"st-filter.directive.js","sourceRoot":"","sources":["../../src/st-filter.directive.ts"],"names":[],"mappings":";;;;AAAA,OAAO,EAAC,SAAS,EAAE,KAAK,EAAqB,UAAU,EAAC,MAAM,eAAe,CAAC;AAC9E,OAAO,EAAC,UAAU,EAAC,MAAM,uBAAuB,CAAC;AACjD,OAAO,EAAC,eAAe,IAAI,MAAM,EAA6B,MAAM,kBAAkB,CAAC;AACvF,OAAO,EAAC,SAAS,EAAe,MAAM,YAAY,CAAC;AACnD,OAAO,EAAC,YAAY,EAAE,oBAAoB,EAAE,GAAG,EAAC,MAAM,gBAAgB,CAAC;;;;;IAUnE,2BAAoB,KAAoB,EAAU,GAAe;QAA7C,UAAK,GAAL,KAAK,CAAe;QAAU,QAAG,GAAH,GAAG,CAAY;;;qBAShC,GAAG;KARnC;;;;;IAUD,kCAAM;;;;IAAN,UAAO,KAAa;QAChB,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;KACxC;;;;IAED,oCAAQ;;;IAAR;QAAA,iBAwBC;QAvBG,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC;YACrB,OAAO,EAAE,IAAI,CAAC,OAAO;YACrB,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,IAAI,EAAE,IAAI,CAAC,IAAI;SAClB,CAAC,CAAC;;QAGH,qBAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,OAAO,KAAK,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC;QAE/E,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,KAAK,CAAC;aAC7D,IAAI,CACD,GAAG,CAAC,UAAC,MAAW,IAAK,OAAA,mBAAmB,MAAM,CAAC,MAAM,EAAC,CAAC,KAAK,EAAvC,CAAuC,CAAC,EAC7D,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,EACxB,oBAAoB,EAAE,CACzB;aACA,SAAS,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAd,CAAc,CAAC,CAAC;QAEpC,qBAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;QAEtC,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;YACrC,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;SAC/D;KACJ;;;;IAED,uCAAW;;;IAAX;QACI,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,CAAC;KACzC;;gBApDJ,SAAS,SAAC;oBACP,QAAQ,EAAE,YAAY;oBACtB,QAAQ,EAAE,UAAU;iBACvB;;;;gBARO,UAAU;gBAD2B,UAAU;;;4BAiBlD,KAAK,SAAC,UAAU;6BAEhB,KAAK,SAAC,kBAAkB;yBAExB,KAAK,SAAC,cAAc;0BAEpB,KAAK,SAAC,gBAAgB;;4BAvB3B;;SAUa,iBAAiB","sourcesContent":["import {Directive, Input, OnInit, OnDestroy, ElementRef} from '@angular/core';\nimport {SmartTable} from './smart-table.service';\nimport {filterDirective as filter, FilterOperator, FilterType} from 'smart-table-core';\nimport {fromEvent, Subscription} from 'rxjs/index';\nimport {debounceTime, distinctUntilChanged, map} from 'rxjs/operators';\n\n@Directive({\n    selector: '[stFilter]',\n    exportAs: 'stFilter'\n})\nexport class StFilterDirective<T> implements OnInit, OnDestroy {\n    private _directive: any;\n    private _inputSubscription: Subscription;\n\n    constructor(private table: SmartTable<T>, private _el: ElementRef) {\n    }\n\n    @Input('stFilter') pointer: string;\n\n    @Input('stFilterOperator') operator = FilterOperator.INCLUDES;\n\n    @Input('stFilterType') type = FilterType.STRING;\n\n    @Input('stDebounceTime') delay = 300;\n\n    filter(value: string): void {\n        return this._directive.filter(value);\n    }\n\n    ngOnInit() {\n        this._directive = filter({\n            pointer: this.pointer,\n            table: this.table,\n            operator: this.operator,\n            type: this.type\n        });\n\n        // fix for Edge https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/4660045/\n        const event = this._el.nativeElement.tagName === 'SELECT' ? 'change' : 'input';\n\n        this._inputSubscription = fromEvent(this._el.nativeElement, event)\n            .pipe(\n                map(($event: any) => (<HTMLInputElement>$event.target).value),\n                debounceTime(this.delay),\n                distinctUntilChanged(),\n            )\n            .subscribe(v => this.filter(v));\n\n        const state = this._directive.state();\n\n        if (Array.isArray(state[this.pointer])) {\n            this._el.nativeElement.value = state[this.pointer][0].value;\n        }\n    }\n\n    ngOnDestroy() {\n        this._directive.off();\n        this._inputSubscription.unsubscribe();\n    }\n}\n"]}